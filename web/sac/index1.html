<!DOCTYPE html>
<html>
<head>
<script>

function httpGet(theUrl)
{
    var xmlHttp = null;

    xmlHttp = new XMLHttpRequest();
    xmlHttp.open( "GET", theUrl, false );
    xmlHttp.send( null );
    return xmlHttp.responseText;
}

function lightOperate(id,value)
{
if( /[0-9]+%/g.test(value)) {
  window.alert("value is a percentage");
}
if( value == "on" ) {
 value = "off";
} else {
value = "on";
}
var url = "http://pi.sacbhale.net:8080/bin/SET;ok?" + id + "=" + value ;
httpGet(url);
}


function loadXMLDoc(url)
{
var lookupTable = {
  "$HolidayLt": function() {
    return "Humidifier";
  },
  "$LivingLt": function() {
    return "Living Room";
  },
  "$DiningLt": function() {
    return "Dining Room";
  },
  "$Hallway3": function() {
    return "Hallway";
  },
  "$MasBathLt": function() {
    return "Master Bedroom";
  },
  "$BathLt": function() {
    return "Common Bath";
  },
  "$Bed1Lt": function() {
    return "Mumma's Room";
  },
  "$Bed2Lt": function() {
    return "Neil's Room";
  },
  "$KitchenLt": function() {
    return "Kitchen";
  },
  "$PorchLt": function() {
    return "Porch";
  },
  "$EntrywayLt": function() {
    return "Entry Way";
  },
  "$OfficeLt": function() {
    return "Office";
  },
  "$GarageLt": function() {
    return "Garage";
  },
  "$FamroomLt":  function() {
    return "Family Room";
  }
};

if(typeof url === 'undefined'){
  url='/sub?xml%28groups=$remote,fields=state%29';
 };
var xmlhttp;
var txt,x,xx,i;
if (window.XMLHttpRequest)
  {// code for IE7+, Firefox, Chrome, Opera, Safari
  xmlhttp=new XMLHttpRequest();
  }
else
  {// code for IE6, IE5
  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  }
xmlhttp.onreadystatechange=function()
  {
  if (xmlhttp.readyState==4 && xmlhttp.status==200)
    {
    txt="<table border='1'><tr><th>Name</th><th>State</th></tr>";
    x=xmlhttp.responseXML.documentElement.getElementsByTagName("object");
    for (i=0;i<x.length;i++)
      {
      txt=txt + "<tr>";
      xx=x[i].getElementsByTagName("name");
        {
        try
          {
          txt=txt + "<td>" + lookupTable[xx[0].firstChild.nodeValue]() + "</td><td><button onclick=lightOperate('" + xx[0].firstChild.nodeValue + "','";
          }
        catch (er)
          {
          txt=txt + "<td> </td>";
          }
        }
      xx=x[i].getElementsByTagName("state");
        {
        try
          {
          txt=txt + xx[0].firstChild.nodeValue +"')>" + xx[0].firstChild.nodeValue + "</button></td>";
          }
        catch (er)
          {
          txt=txt + "<td> </td>";
          }
        }
      txt=txt + "</tr>";
      }
    txt=txt + "</table>";
    if ( txt != document.getElementById('txtLights').innerHTML )
    document.getElementById('txtLights').innerHTML=txt;
    }
  }
xmlhttp.open("GET",url,true);
xmlhttp.send();
}
setInterval(loadXMLDoc,1500);
</script>
</head>
<body>

<div id="txtLights">
Loading...
</div>

</body>
</html>
